{
  "dBType" : "MYSQL5",
  "name" : "MySQL5",
  "getPSDEDataQueryCodeExps" : [ {
    "expression" : "t1.`ACCOUNT`",
    "name" : "ACCOUNT"
  }, {
    "expression" : "t1.`CONSUMED`",
    "name" : "CONSUMED"
  }, {
    "expression" : "t1.`DATE`",
    "name" : "DATE"
  }, {
    "expression" : "t1.`ID`",
    "name" : "ID"
  }, {
    "expression" : "t1.`LEFT`",
    "name" : "LEFT"
  }, {
    "expression" : "t1.`TASK`",
    "name" : "TASK"
  } ],
  "queryCode" : "select \nt1.*,\nt2.`name` AS taskname,\nt2.deadline,\nt2.ESTSTARTED,\nt2.type AS TASKTYPE,\n(CONCAT_WS('', CASE WHEN t2.consumed = 0 OR t2.consumed IS NULL THEN '0' WHEN t2.`left` = 0 OR t2.`left` IS NULL THEN '100' ELSE ROUND((ROUND(t2.`consumed`/( t2.`left` + t2.consumed ), 2 )) * 100 ) END, '%')) AS PROGRESSRATE, \n((CASE WHEN t2.deadline IS NULL OR t2.deadline = '0000-00-00' OR t2.deadline = '1970-01-01' THEN '' WHEN t2.`status` IN ( 'wait', 'doing' ) AND t2.deadline < DATE_FORMAT(now(), '%Y-%m-%d') THEN CONCAT_WS('', '延期', TIMESTAMPDIFF(DAY, t2.deadline, now()), '天') ELSE '' END)) AS DELAYDAYS \nfrom\n(SELECT\nt1.DATE,\nt1.TASK,\nt1.ACCOUNT,\nROUND(sum(t1.CONSUMED), 2) AS CONSUMED,\ntask AS id \nFROM\n`zt_taskestimate` t1 \nWHERE\nt1.date >= DATE_FORMAT(${srfdatacontext('begin')}, '%Y-%m-%d')\nAND t1.date <= DATE_FORMAT(${srfdatacontext('end')}, '%Y-%m-%d')\nGROUP BY t1.DATE, t1.TASK, t1.ACCOUNT) t1\nleft join zt_task t2 \non t1.task = t2.id \nwhere \nFIND_IN_SET(t1.task, ${srfdatacontext('tasks')})\n",
  "id" : "PSMODULES/ibizpro/PSDATAENTITIES/IbzproProductUserTask/PSDEDATAQUERIES/ProductWeeklyUserTaskStats/PSDEDQCODES/MYSQL5.json"
}