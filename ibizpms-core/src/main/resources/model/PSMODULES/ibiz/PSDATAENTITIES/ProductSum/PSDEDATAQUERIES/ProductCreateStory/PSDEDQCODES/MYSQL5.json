{
  "dBType" : "MYSQL5",
  "name" : "MySQL5",
  "getPSDEDataQueryCodeExps" : [ {
    "expression" : "0",
    "name" : "ACTIVESTORYCNT"
  }, {
    "expression" : "0",
    "name" : "CHANGEDSTORYCNT"
  }, {
    "expression" : "0",
    "name" : "CLOSEDSTORYCNT"
  }, {
    "expression" : "t1.`ID`",
    "name" : "ID"
  }, {
    "expression" : "t1.`NAME`",
    "name" : "NAME"
  }, {
    "expression" : "0",
    "name" : "PLAN"
  }, {
    "expression" : "t1.`PO`",
    "name" : "PO"
  }, {
    "expression" : "0",
    "name" : "STORYCNT"
  }, {
    "expression" : "0",
    "name" : "WAITSTORYCNT"
  } ],
  "queryCode" : "\tSELECT\n0 AS `ACTIVESTORYCNT`,\n0 AS `CHANGEDSTORYCNT`,\n0 AS `CLOSEDSTORYCNT`,\nt1.`ID`,\nt1.`NAME`,\n0 AS `PLAN`,\nt1.`PO`,\nt2.storycnt AS `STORYCNT`,\n0 AS `WAITSTORYCNT`,\nt2.zhanbi\nFROM `zt_product` t1\n\nINNER JOIN (\nSELECT t1.*,IFNULL(t2.storycnt,0) as storycnt,IFNULL(t2.allstorycnt,0) as allstorycnt,IFNULL(t2.zhanbi,0) as zhanbi from (\nSELECT t1.id,t1.`name`,t1.`status` from zt_product t1 where t1.id in (SELECT t1.id from zt_product t1 where YEAR(t1.createddate) =   #{srf.webcontext.curyear} \nand (t1.createdBy =  #{srf.sessioncontext.srfloginname} \nor t1.po =  #{srf.sessioncontext.srfloginname} \nor t1.QD =  #{srf.sessioncontext.srfloginname} \nor t1.RD =  #{srf.sessioncontext.srfloginname} )) \nor t1.id in (SELECT DISTINCT t1.product from zt_story t1 where t1.openedBy =  #{srf.sessioncontext.srfloginname} \nand YEAR(t1.openeddate) =   #{srf.webcontext.curyear}) \nor t1.id in (SELECT DISTINCT t1.product from zt_productplan t1 LEFT JOIN zt_action t2 on t1.id = t2.OBJECTID and t2.objectType = 'productplan' where YEAR(t2.date) =   #{srf.webcontext.curyear} \nand t2.actor =  #{srf.sessioncontext.srfloginname} \nand t2.action = 'opened' ) ) t1\n\nLEFT JOIN (\nselect t1.*,t2.allstorycnt , CONCAT(ROUND(t1.storycnt/(case when t2.allstorycnt = 0 or t2.allstorycnt is null then 1 else t2.allstorycnt end)*100,1),'%') as zhanbi from\n(SELECT t1.openedBy,t1.productid,t1.productname,COUNT(1) as storycnt from (\nSELECT t1.id,t1.openedBy,t2.id as productid ,t2.`name` as productname from zt_story t1 LEFT JOIN zt_product t2 on t2.id = t1.product) t1 GROUP BY t1.openedBy,t1.productid ) t1\nLEFT JOIN (select t1.productid,t1.productname,COUNT(1) as allstorycnt from (\nSELECT t1.id,t1.openedBy,t2.id as productid ,t2.`name` as productname from zt_story t1 LEFT JOIN zt_product t2 on t2.id = t1.product ) t1 GROUP BY t1.productid) t2 on t2.productid = t1.productid\n\nhaving t1.openedBy =  #{srf.sessioncontext.srfloginname}\n) t2 on t1.id = t2.productid\n) t2 on t1.id = t2.id",
  "id" : "PSMODULES/ibiz/PSDATAENTITIES/ProductSum/PSDEDATAQUERIES/ProductCreateStory/PSDEDQCODES/MYSQL5.json"
}