{
  "dBType" : "MYSQL5",
  "name" : "MySQL5",
  "queryCode" : "select t1.*  from(select \nt1.id,t1.`NAME`,t1.po,t1.PLAN, case when t1.`begin` = '2030-01-01' then '待定' else t1.`begin` end as `begin`,case when t1.`end` = '2030-01-01' then '待定' else t1.`end` end as `end`,\n\tsum( IF ( t1.`status` = 'draft', t1.rowcnt, 0 ) ) AS WAITSTORYCNT,\n\tSUM( IF ( t1.`status` = 'active', t1.rowcnt, 0 ) ) AS ACTIVESTORYCNT,\n\tSUM( IF ( t1.`status` = 'changed', t1.rowcnt, 0 ) ) AS CHANGEDSTORYCNT,\n\tSUM( IF ( t1.`status` = 'closed', t1.rowcnt, 0 ) ) AS CLOSEDSTORYCNT,\n\tsum( IF ( t1.`deleted` = '0',  t1.rowcnt, 0) ) AS STORYCNT \nFROM\n\t(\n\tSELECT\n\t\t1 AS rowcnt,\n\tt41.id as plan,\n\t\tt31.`NAME` AS `NAME`,\n\t\tt31.id AS id,\n\t\tt1.`status`,\n\t\tt31.po,\n\t\tt41.`begin`,\n\t\tt41.`end` ,\n\t\tt1.deleted\n\tFROM\n\t\tzt_product t31\n\t\tLEFT JOIN ZT_PRODUCTPLAN t41 ON t41.PRODUCT = t31.ID\n\t\tLEFT JOIN  `zt_story` t1  ON t41.id = t1.plan \nwhere t31.deleted = '0' and  (\n\t\t\t( ( t31.`status` = 'normal' ) OR ( t31.`status` = 'closed' AND #{srf.datacontext.closed} = '1' ) ) \n\t\t\tand ( t41.id is null or\n\t\t\t\t( t41.`end` >= now( ) ) \n\t\t\t\tOR ( t41.`end` <= now( ) AND #{srf.datacontext.expired} = '1' ) \n\t\t\t) \n\t\t)\n) t1 GROUP BY t1.id,t1.`NAME`,t1.po,t1.PLAN,t1.`begin`,t1.`end`) t1",
  "id" : "PSMODULES/ibiz/PSDATAENTITIES/ProductSum/PSDEDATAQUERIES/Default/PSDEDQCODES/MYSQL5.json"
}