{
  "dBType" : "MYSQL5",
  "name" : "MySQL5",
  "queryCode" : "SELECT\n\tt1.project,\n\tt2.`name` as PROJECTNAME,\n\tt1.finishedBy,\n\tsum( t1.estimate ) AS TOTALESTIMATE,\n\tsum( t1.consumed ) AS TOTALCONSUMED,\n\tCASE WHEN sum( t1.consumed ) <= sum( t1.estimate ) THEN\n\t\t'100.00%' ELSE CONCAT ( FORMAT(( sum( t1.estimate ) / sum( t1.consumed )) * 100, 2 ), '%' ) \n\tEND AS TASKEFFICIENT\nFROM\n\t((\n\t\tSELECT\n\t\t\tt1.project,\n\t\t\tt1.finishedBy,\n\t\t\tt1.estimate,\n\t\t\tCASE WHEN t2.consumed IS NULL THEN\n\t\t\t\tt1.consumed ELSE t2.consumed \n\t\t\tEND AS consumed \n\t\tFROM\n\t\t\tzt_task t1\n\t\t\tLEFT JOIN zt_taskestimate t2 ON t1.id = t2.task \n\t\tWHERE\n\t\t\tt1.deleted = '0' \n\t\t\tAND t1.parent <> - 1 \n\t\t\tAND t1.`status` IN ( 'done', 'closed' ) \n\t\t\tAND t1.finishedBy <> '' \n\t\t\tAND t1.id NOT IN ( SELECT t1.id FROM zt_team t1 WHERE t1.type = 'task' ) \n\t\t\t) UNION\n\t\t(\n\t\tSELECT\n\t\t\tt1.project,\n\t\t\tt2.account AS finishedBy,\n\t\t\tt2.estimate,\n\t\t\tCASE WHEN t3.consumed IS NULL THEN\n\t\t\t\tt2.consumed ELSE t3.consumed \n\t\t\tEND AS consumed \n\t\tFROM\n\t\t\tzt_task t1\n\t\t\tJOIN zt_team t2 ON t2.type = 'task' \n\t\t\tAND t1.id = t2.root\n\t\t\tLEFT JOIN zt_taskestimate t3 ON t1.id = t3.task \n\t\t\tAND t2.account = t3.account \n\t\tWHERE\n\t\t\tt1.deleted = '0' \n\t\t\tAND t1.parent <> - 1 \n\t\tAND t1.`status` IN ( 'done', 'closed' )) \n\t) t1\n\tJOIN zt_project t2 ON t1.project = t2.id \nWHERE\n\tt2.deleted = '0' \nGROUP BY\n\tt1.project,\n\tt1.finishedBy",
  "id" : "PSMODULES/ibiz/PSDATAENTITIES/TaskStats/PSDEDATAQUERIES/UserFinishTaskSum/PSDEDQCODES/MYSQL5.json"
}