{
  "dBType" : "MYSQL5",
  "name" : "MySQL5",
  "queryCode" : "SELECT\n\tt1.*,\n\tCONCAT(\n\tIFNULL( ROUND( ( t1.TOTALCONSUMED / ( t1.TOTALCONSUMED + t1.TOTALLEFT ) )*100, 2 ), 0 ),\n\t'%' \n\t) AS progress \nFROM\n\t(\nSELECT\n\tIFNULL(\n\t(\nSELECT\n\tCOUNT( 1 ) \nFROM\n\tZT_STORY \nWHERE\n\t`STAGE` IN ( 'projected', 'developing' ) \n\tAND FIND_IN_SET ( PRODUCT, ( SELECT GROUP_CONCAT( PRODUCT ) FROM ZT_PROJECTPRODUCT WHERE PROJECT = t1.`ID` ) ) \n\tAND DELETED = '0' \n\t),\n\t0 \n\t) AS `LEFTSTORYCNT`,\n\tt1.`DELETED`,\n\tt1.`ID`,\n\tt1.`NAME`,\n\tt1.`STATUS`,\n\tIFNULL(\n\t(\nSELECT\n\tCOUNT( 1 ) \nFROM\n\tZT_STORY \nWHERE\n\t FIND_IN_SET ( PRODUCT, ( SELECT GROUP_CONCAT( PRODUCT ) FROM ZT_PROJECTPRODUCT WHERE PROJECT = t1.`ID` ) ) \n\tAND DELETED = '0'\n\t),\n\t0 \n\t) AS `STORYCNT`,\n\tIFNULL( ( SELECT COUNT( 1 ) FROM ZT_TASK WHERE PROJECT = t1.`ID` AND DELETED = '0' ), 0 ) AS `TASKCNT`,\n\tIFNULL(\n\t(\nSELECT\n\tround( SUM( CONSUMED ), 0 ) \nFROM\n\tZT_TASK \nWHERE\n\tPROJECT = t1.`ID` \n\tAND DELETED = '0' \n\tAND ( `parent` = '' OR `parent` = '0' OR `parent` = '-1' ) \n\t),\n\t0 \n\t) AS `TOTALCONSUMED`,\n\tIFNULL(\n\t(\nSELECT\n\tround( SUM( `LEFT` ), 0 ) \nFROM\n\tZT_TASK \nWHERE\n\tPROJECT = t1.`ID` \n\tAND DELETED = '0' \n\tAND ( `parent` = '' OR `parent` = '0' OR `parent` = '-1' ) \n\t),\n\t0 \n\t) AS `TOTALLEFT`,\n\tIFNULL(\n\t(\nSELECT\n\tCOUNT( 1 ) \nFROM\n\tZT_TASK \nWHERE\n\tPROJECT = t1.`ID` \n\tAND `STATUS` NOT IN ( 'done', 'cancel', 'closed' ) \n\tAND DELETED = '0' \n\t),\n\t0 \n\t) AS `UNDONETASKCNT`,\n\t( CASE WHEN T2.OBJECTORDER IS NOT NULL THEN T2.OBJECTORDER ELSE t1.`ORDER` END ) AS `ORDER1`,\n\t( CASE WHEN T2.OBJECTORDER IS NOT NULL THEN 1 ELSE 0 END ) AS `ISTOP` \nFROM\n\t`zt_project` t1\n\tLEFT JOIN t_ibz_top t2 ON t1.id = t2.OBJECTID \n\tAND t2.type = 'project' \n\tAND t2.ACCOUNT = #{srf.sessioncontext.srfloginname} \nWHERE\n\tt1.DELETED = '0' \n\tAND (\n\t(\n\tt1.acl = 'private' \n\tAND t1.id IN ( SELECT t3.root FROM zt_team t3 WHERE t3.account = #{srf.sessioncontext.srfloginname} AND t3.type = 'project' ) \n\t) \n\tOR t1.acl = 'open' \n\t) \n\t) t1",
  "id" : "PSMODULES/ibiz/PSDATAENTITIES/ProjectStats/PSDEDATAQUERIES/ProjectProgress/PSDEDQCODES/MYSQL5.json"
}