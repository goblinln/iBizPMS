{
  "dBType" : "MYSQL5",
  "name" : "MySQL5",
  "getPSDEDataQueryCodeConds" : [ {
    "condType" : "CUSTOM",
    "customCond" : "t1.DELETED = '0'",
    "name" : "查询条件"
  }, {
    "condType" : "CUSTOM",
    "customCond" : "(t1.id in(\n\tSELECT t.root from zt_team t\nWHERE\n\tt.account =  #{srf.sessioncontext.srfloginname}\n\tAND t.type = 'product' \n\t \n\t) or t1.acl = 'open' )\n\t",
    "name" : "查询条件"
  }, {
    "condType" : "CUSTOM",
    "customCond" : "t1.orgid = #{srf.sessioncontext.srforgid}",
    "name" : "查询条件"
  } ],
  "getPSDEDataQueryCodeExps" : [ {
    "expression" : "(SELECT COUNT(1) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND `STATUS` = 'active' AND DELETED ='0')",
    "name" : "ACTIVEBUGCNT"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND `STATUS`='active' AND DELETED = '0')",
    "name" : "ACTIVESTORYCNT"
  }, {
    "expression" : "1",
    "name" : "ASSIGNTOMEBUGCNT"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND DELETED = '0')",
    "name" : "BUGCNT"
  }, {
    "expression" : "t1.`CODE`",
    "name" : "CODE"
  }, {
    "expression" : "(SELECT t.name FROM zt_project t,zt_projectproduct t2 WHERE t.id=t2.project and t2.product = t1.id limit 1)",
    "name" : "CURRPROJECT"
  }, {
    "expression" : "t1.`DELETED`",
    "name" : "DELETED"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND STAGE = 'developing' AND DELETED = '0')",
    "name" : "DEVELOPINGSTORYCNT"
  }, {
    "expression" : "t1.`ID`",
    "name" : "ID"
  }, {
    "expression" : "t1.`NAME`",
    "name" : "NAME"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_RELEASE WHERE PRODUCT= t1.`ID` AND  `STATUS`= 'normal' AND DELETED = '0')",
    "name" : "NORMALRELEASECNT"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND `STATUS` <> 'closed' AND DELETED = '0')",
    "name" : "NOTCLOSEDBUGCNT"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND STAGE = 'planned' AND DELETED ='0')",
    "name" : "PLANNEDSTORYCNT"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_PROJECT t2 LEFT JOIN ZT_PROJECTPRODUCT t ON t2.ID = t.project WHERE t.PRODUCT = t1.id AND t2.DELETED = '0' and t2.`status` in( 'wait','doing') and t2.`END` < now() )",
    "name" : "POSTPONEDPROJECTCNT"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_PRODUCTPLAN WHERE PRODUCT= t1.`ID` AND DELETED = '0')",
    "name" : "PRODUCTPLANCNT"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_RELEASE WHERE PRODUCT= t1.`ID` AND DELETED = '0')",
    "name" : "RELEASECNT"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND STAGE = 'released' AND DELETED = '0')",
    "name" : "RELEASEDSTORYCNT"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_PROJECT LEFT JOIN ZT_PROJECTPRODUCT ON  ZT_PROJECT.ID = ZT_PROJECTPRODUCT.project WHERE PRODUCT = t1.`ID` AND DELETED = '0')",
    "name" : "RESPROJECTCNT"
  }, {
    "expression" : "t1.`STATUS`",
    "name" : "STATUS"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND DELETED = '0')",
    "name" : "STORYCNT"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND STAGE = 'testing' AND DELETED = '0')",
    "name" : "TESTINGSTORYCNT"
  }, {
    "expression" : "t1.`TYPE`",
    "name" : "TYPE"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND `CONFIRMED` = 0 AND DELETED = '0')",
    "name" : "UNCONFIRMBUGCNT"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_PROJECT LEFT JOIN ZT_PROJECTPRODUCT ON  ZT_PROJECT.ID = ZT_PROJECTPRODUCT.project WHERE PRODUCT = t1.`ID` AND `STATUS` <> 'closed' AND DELETED = '0')",
    "name" : "UNDONERESPROJECTCNT"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_PRODUCTPLAN WHERE PRODUCT= t1.`ID`  AND `END` > CURDATE() AND DELETED = '0')",
    "name" : "UNENDPRODUCTPLANCNT"
  }, {
    "expression" : "(SELECT COUNT(1) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND STAGE = 'wait' AND DELETED = '0')",
    "name" : "WAITSTORYCNT"
  }, {
    "expression" : "(SELECT COUNT( 1 ) FROM ZT_BUG WHERE PRODUCT = t1.`ID`  AND DELETED = '0' and resolvedDate BETWEEN CONCAT(YEAR(DATE_ADD(now(),INTERVAL -1 day)),'-',month(DATE_ADD(now(),INTERVAL -1 day)),'-',day(DATE_ADD(now(),INTERVAL -1 day)),' 00:00:00') and CONCAT(YEAR(DATE_ADD(now(),INTERVAL -1 day)),'-',month(DATE_ADD(now(),INTERVAL -1 day)),'-',day(DATE_ADD(now(),INTERVAL -1 day)),' 23:59:59'))",
    "name" : "YESTERDAYCLOSEDBUGCNT"
  }, {
    "expression" : "5",
    "name" : "YESTERDAYCONFIRMBUGCNT"
  }, {
    "expression" : "(SELECT COUNT( 1 ) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND `STATUS` = 'closed' AND DELETED = '0' and CLOSEDDATE BETWEEN CONCAT(YEAR(DATE_ADD(now(),INTERVAL -1 day)),'-',month(DATE_ADD(now(),INTERVAL -1 day)),'-',day(DATE_ADD(now(),INTERVAL -1 day)),' 00:00:00') and CONCAT(YEAR(DATE_ADD(now(),INTERVAL -1 day)),'-',month(DATE_ADD(now(),INTERVAL -1 day)),'-',day(DATE_ADD(now(),INTERVAL -1 day)),' 23:59:59'))",
    "name" : "YESTERDAYRESOLVEDBUGCNT"
  } ],
  "queryCode" : "SELECT\n\t( SELECT COUNT( 1 ) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND `STATUS` = 'active' AND DELETED = '0' ) AS `ACTIVEBUGCNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND `STATUS` = 'active' AND DELETED = '0' ) AS `ACTIVESTORYCNT`,\n\t1 AS `ASSIGNTOMEBUGCNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND DELETED = '0' ) AS `BUGCNT`,\n\tt1.`CODE`,\n\t(\nSELECT\n\tt.NAME \nFROM\n\tzt_project t,\n\tzt_projectproduct t2 \nWHERE\n\tt.id = t2.project \n\tAND t2.product = t1.id \n\tLIMIT 1 \n\t) AS `CURRPROJECT`,\n\tt1.`DELETED`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND STAGE = 'developing' AND DELETED = '0' ) AS `DEVELOPINGSTORYCNT`,\n\tt1.`ID`,\n\tt1.`NAME`,\n\t( SELECT COUNT( 1 ) FROM ZT_RELEASE WHERE PRODUCT = t1.`ID` AND `STATUS` = 'normal' AND DELETED = '0' ) AS `NORMALRELEASECNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND `STATUS` <> 'closed' AND DELETED = '0' ) AS `NOTCLOSEDBUGCNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND STAGE = 'planned' AND DELETED = '0' ) AS `PLANNEDSTORYCNT`,\n\t(\nSELECT\n\tCOUNT( 1 ) \nFROM\n\tZT_PROJECT t2\n\tLEFT JOIN ZT_PROJECTPRODUCT t ON t2.ID = t.project \nWHERE\n\tt.PRODUCT = t1.id \n\tAND t2.DELETED = '0' \n\tAND t2.`status` IN ( 'wait', 'doing' ) \n\tAND t2.`END` < now( ) \n\t) AS `POSTPONEDPROJECTCNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_PRODUCTPLAN WHERE PRODUCT = t1.`ID` AND DELETED = '0' ) AS `PRODUCTPLANCNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_RELEASE WHERE PRODUCT = t1.`ID` AND DELETED = '0' ) AS `RELEASECNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND STAGE = 'released' AND DELETED = '0' ) AS `RELEASEDSTORYCNT`,\n\t(\nSELECT\n\tCOUNT( 1 ) \nFROM\n\tZT_PROJECT\n\tLEFT JOIN ZT_PROJECTPRODUCT ON ZT_PROJECT.ID = ZT_PROJECTPRODUCT.project \nWHERE\n\tPRODUCT = t1.`ID` \n\tAND DELETED = '0' \n\t) AS `RESPROJECTCNT`,\n\tt1.`STATUS`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND DELETED = '0' ) AS `STORYCNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND STAGE = 'testing' AND DELETED = '0' ) AS `TESTINGSTORYCNT`,\n\tt1.`TYPE`,\n\t( SELECT COUNT( 1 ) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND `CONFIRMED` = 0 AND DELETED = '0' ) AS `UNCONFIRMBUGCNT`,\n\t(\nSELECT\n\tCOUNT( 1 ) \nFROM\n\tZT_PROJECT\n\tLEFT JOIN ZT_PROJECTPRODUCT ON ZT_PROJECT.ID = ZT_PROJECTPRODUCT.project \nWHERE\n\tPRODUCT = t1.`ID` \n\tAND `STATUS` <> 'closed' \n\tAND DELETED = '0' \n\t) AS `UNDONERESPROJECTCNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_PRODUCTPLAN WHERE PRODUCT = t1.`ID` AND `END` > CURDATE( ) AND DELETED = '0' ) AS `UNENDPRODUCTPLANCNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND STAGE = 'wait' AND DELETED = '0' ) AS `WAITSTORYCNT`,\n\t(\nSELECT\n\tCOUNT( 1 ) \nFROM\n\tZT_BUG \nWHERE\n\tPRODUCT = t1.`ID` \n\tAND DELETED = '0' \n\tAND resolvedDate BETWEEN CONCAT(\n\tYEAR ( DATE_ADD( now( ), INTERVAL - 1 DAY ) ),\n\t'-',\n\tMONTH ( DATE_ADD( now( ), INTERVAL - 1 DAY ) ),\n\t'-',\n\tDAY ( DATE_ADD( now( ), INTERVAL - 1 DAY ) ),\n\t' 00:00:00' \n\t) \n\tAND CONCAT(\n\tYEAR ( DATE_ADD( now( ), INTERVAL - 1 DAY ) ),\n\t'-',\n\tMONTH ( DATE_ADD( now( ), INTERVAL - 1 DAY ) ),\n\t'-',\n\tDAY ( DATE_ADD( now( ), INTERVAL - 1 DAY ) ),\n\t' 23:59:59' \n\t) \n\t) AS `YESTERDAYCLOSEDBUGCNT`,\n\t5 AS `YESTERDAYCONFIRMBUGCNT`,\n\t(\nSELECT\n\tCOUNT( 1 ) \nFROM\n\tZT_BUG \nWHERE\n\tPRODUCT = t1.`ID` \n\tAND `STATUS` = 'closed' \n\tAND DELETED = '0' \n\tAND CLOSEDDATE BETWEEN CONCAT(\n\tYEAR ( DATE_ADD( now( ), INTERVAL - 1 DAY ) ),\n\t'-',\n\tMONTH ( DATE_ADD( now( ), INTERVAL - 1 DAY ) ),\n\t'-',\n\tDAY ( DATE_ADD( now( ), INTERVAL - 1 DAY ) ),\n\t' 00:00:00' \n\t) \n\tAND CONCAT(\n\tYEAR ( DATE_ADD( now( ), INTERVAL - 1 DAY ) ),\n\t'-',\n\tMONTH ( DATE_ADD( now( ), INTERVAL - 1 DAY ) ),\n\t'-',\n\tDAY ( DATE_ADD( now( ), INTERVAL - 1 DAY ) ),\n\t' 23:59:59' \n\t) \n\t) AS `YESTERDAYRESOLVEDBUGCNT` ,\n\t\t(CASE WHEN T2.OBJECTORDER IS NOT NULL THEN T2.OBJECTORDER ELSE  t1.`ORDER` END) as `ORDER1`,\n\t(CASE WHEN T2.OBJECTORDER IS NOT NULL THEN 1 ELSE 0 END) as `ISTOP`\nFROM\n\t`zt_product` t1\n\tleft join t_ibz_top t2 on t1.id = t2.OBJECTID and t2.type = 'product' and t2.ACCOUNT = #{srf.sessioncontext.srfloginname}",
  "id" : "PSMODULES/ibiz/PSDATAENTITIES/ProductStats/PSDEDATAQUERIES/Default/PSDEDQCODES/MYSQL5.json"
}