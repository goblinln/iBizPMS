{
  "dBType" : "MYSQL5",
  "name" : "MySQL5",
  "queryCode" : " select t1.* from (SELECT\nt1.MDEPTID,\nt1.orgid,\nt1.`ACL`,\nt1.`BEGIN`,\n(SELECT COUNT(1) FROM ZT_BUG WHERE PROJECT = t1.`ID` AND DELETED = '0') AS `BUGCNT`,\nt1.`CANCELEDBY`,\nt1.`CANCELEDDATE`,\nt1.`CATID`,\nt1.`CLOSEDBY`,\nt1.`CLOSEDDATE`,\nt1.`CODE`,\nt1.`DAYS`,\nt1.`DELETED`,\nt1.`END`,\nt1.`ID`,\nt1.`ISCAT`,\n'0' AS `ISTOP`,\nt1.`NAME`,\nt1.`OPENEDBY`,\nt1.`OPENEDDATE`,\nt1.`OPENEDVERSION`,\nt1.`ORDER`,\nt1.`order` AS `ORDER1`,\nt1.`PARENT`,\nt11.`NAME` AS `PARENTNAME`,\nt1.`PM`,\nt1.`PO`,\nt1.`PRI`,\nt1.`QD`,\nt1.`RD`,\nt1.`STATGE`,\nCASE \n\tWHEN t1.`STATUS` = 'wait' THEN\n\t\t'doing'\n\tELSE\n\t\tt1.`STATUS`\nEND  as `STATUS`,\n(SELECT COUNT(1) FROM ZT_STORY LEFT JOIN ZT_PROJECTSTORY ON ZT_STORY.ID = ZT_PROJECTSTORY.STORY WHERE PROJECT = t1.`ID` AND DELETED = '0') AS `STORYCNT`,\nt1.`SUBSTATUS`,\n(SELECT COUNT(1) FROM ZT_TASK WHERE PROJECT = t1.`ID` AND DELETED = '0') AS `TASKCNT`,\nt1.`TEAM`,\n(SELECT round(SUM(CONSUMED),0) FROM ZT_TASK WHERE PROJECT = t1.`ID` AND DELETED = '0' AND ( `parent` = '' or `parent` = '0' or `parent` = '-1')) AS `TOTALCONSUMED`,\n(SELECT round(SUM(ESTIMATE),0) FROM ZT_TASK WHERE PROJECT = t1.`ID` AND DELETED =  '0' AND ( `parent` = '' or `parent` = '0' or `parent` = '-1')) AS `TOTALESTIMATE`,\n(select sum(days * hours)  from zt_team tt where type = 'project' and root = t1.id) AS `TOTALHOURS`,\n(SELECT round(SUM(`LEFT`),0) FROM ZT_TASK WHERE PROJECT = t1.`ID` AND DELETED = '0' and `status` in ('doing','wait','pause') AND ( `parent` = '' or `parent` = '0' or `parent` = '-1')) AS `TOTALLEFT`,\n((SELECT round(SUM( `LEFT` ),0) FROM ZT_TASK WHERE PROJECT = t1.`ID` AND DELETED = '0' AND ( `parent` = '' OR `parent` = '0' OR `parent` = '-1' ) AND `status` in ('doing','wait','pause')) + (SELECT round(SUM( CONSUMED ),0) FROM ZT_TASK WHERE PROJECT = t1.`ID` AND DELETED = '0' AND ( `parent` = '' OR `parent` = '0' OR `parent` = '-1' ))) AS `TOTALWH`,\nt1.`TYPE`,\nt1.PROJECTSN\nFROM `zt_project` t1 \nLEFT JOIN zt_project t11 ON t1.PARENT = t11.ID \nwhere t1.id in ( SELECT t1.id from zt_project t1 where (YEAR(t1.`begin`) <= #{srf.webcontext.curyear} \nand YEAR(t1.`end`) >= \n#{srf.webcontext.curyear}\n) and ( t1.openedBy = #{srf.sessioncontext.srfloginname}\nor t1.PO =#{srf.sessioncontext.srfloginname} \nor t1.PM =#{srf.sessioncontext.srfloginname}\nor t1.QD =#{srf.sessioncontext.srfloginname} \nor t1.RD =#{srf.sessioncontext.srfloginname}\n) ) or t1.id in ( select t1.root from zt_team t1 where t1.type = 'project' and t1.account =#{srf.sessioncontext.srfloginname} \nand \nYEAR(t1.`join`) = #{srf.webcontext.curyear} \n) or t1.id in  (SELECT DISTINCT t1.project from zt_task t1 LEFT JOIN zt_action t2 on t1.id = t2.OBJECTID and t2.objectType = 'task' where t2.actor = #{srf.sessioncontext.srfloginname}\nand t2.action = 'finished' and left(t2.date,4) = #{srf.webcontext.curyear} \n)\n) t1",
  "id" : "PSMODULES/zentao/PSDATAENTITIES/Project/PSDEDATAQUERIES/InvolvedProject/PSDEDQCODES/MYSQL5.json"
}