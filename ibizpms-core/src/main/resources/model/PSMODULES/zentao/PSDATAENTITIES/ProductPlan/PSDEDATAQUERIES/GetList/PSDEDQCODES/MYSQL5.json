{
  "dBType" : "MYSQL5",
  "name" : "MySQL5",
  "getPSDEDataQueryCodeConds" : [ {
    "condType" : "CUSTOM",
    "customCond" : "t1.DELETED = '0'",
    "name" : "查询条件"
  }, {
    "condType" : "CUSTOM",
    "customCond" : "( ( t1.`PRODUCT` = ${srfdatacontext('product','{\"defname\":\"PRODUCT\",\"dename\":\"ZT_PRODUCTPLAN\"}')}  OR  t1.`PRODUCT` = ${srfdatacontext('products','{\"defname\":\"PRODUCT\",\"dename\":\"ZT_PRODUCTPLAN\"}')} ) )",
    "name" : "查询条件"
  } ],
  "getPSDEDataQueryCodeExps" : [ {
    "expression" : "t1.`DESC`",
    "name" : "DESC"
  }, {
    "expression" : "t1.`ORDER`",
    "name" : "ORDER"
  }, {
    "expression" : "t1.`BEGIN`",
    "name" : "BEGIN"
  }, {
    "expression" : "(case when t1.`begin` = '2030-01-01' then '待定' else t1.`begin` end)",
    "name" : "BEGINSTR"
  }, {
    "expression" : "t1.`BRANCH`",
    "name" : "BRANCH"
  }, {
    "expression" : "((select count(t.id) FROM zt_bug t where  t.product = t1.product and  (t.plan = t1.id or (t.plan in (select t2.id from zt_productplan t2 where t2.parent = t1.id and t2.deleted = '0')) )  and t.deleted = '0'))",
    "name" : "BUGCNT"
  }, {
    "expression" : "t1.`CREATEBY`",
    "name" : "CREATEBY"
  }, {
    "expression" : "case when t1.`end` is null or t1.`end` = '0000-00-00' or t1.`end` = '1970-01-01' then '' when t1.`status` in('wait','doing') and t1.`end` < DATE_FORMAT(NOW(),'%Y-%m-%d') then CONCAT('','延期',TO_DAYS(NOW()) - TO_DAYS(t1.`end`),'天') ELSE '' end",
    "name" : "DELAY"
  }, {
    "expression" : "t1.`DELETED`",
    "name" : "DELETED"
  }, {
    "expression" : "t1.`DEPT`",
    "name" : "DEPT"
  }, {
    "expression" : "t1.`DEPTNAME`",
    "name" : "DEPTNAME"
  }, {
    "expression" : "(to_Days(t1.`END`) - to_Days(t1.`BEGIN`))",
    "name" : "DURATION"
  }, {
    "expression" : "t1.`END`",
    "name" : "END"
  }, {
    "expression" : "(case when t1.`end` = '2030-01-01' then '待定' else t1.`end` end)",
    "name" : "ENDSTR"
  }, {
    "expression" : "(select sum(t.estimate) from zt_story t where  t.product = t1.product and  (t.plan = t1.id or (t.plan in (select t2.id from zt_productplan t2 where t2.parent = t1.id and t2.deleted = '0')) )  and t.deleted = '0' )",
    "name" : "ESTIMATECNT"
  }, {
    "expression" : "(case when t1.`begin` = '2030-01-01' or t1.`end` = '2030-01-01' then 'on' else '' end)",
    "name" : "FUTURE"
  }, {
    "expression" : "t1.`ID`",
    "name" : "ID"
  }, {
    "expression" : "(case when t1.`end` > now() then '0' else '1' end)",
    "name" : "ISEXPIRED"
  }, {
    "expression" : "t1.`ORG`",
    "name" : "ORG"
  }, {
    "expression" : "t1.`ORGNAME`",
    "name" : "ORGNAME"
  }, {
    "expression" : "t1.`PARENT`",
    "name" : "PARENT"
  }, {
    "expression" : "t11.`TITLE`",
    "name" : "PARENTNAME"
  }, {
    "expression" : "t1.`PRODUCT`",
    "name" : "PRODUCT"
  }, {
    "expression" : "t1.`PRODUCTPLANSN`",
    "name" : "PRODUCTPLANSN"
  }, {
    "expression" : "t1.`STATUS`",
    "name" : "STATUS"
  }, {
    "expression" : "(case when t1.parent = -1 then 'parent' when t1.parent > 0 then  'chlid' else 'normal' end)",
    "name" : "STATUSS"
  }, {
    "expression" : "((select COUNT(t.id) from zt_story t where  t.product = t1.product and  (t.plan = t1.id or (t.plan in (select t2.id from zt_productplan t2 where t2.parent = t1.id and t2.deleted = '0')) )  and t.deleted = '0' ))",
    "name" : "STORYCNT"
  }, {
    "expression" : "t1.`TITLE`",
    "name" : "TITLE"
  }, {
    "expression" : "t1.`UPDATEBY`",
    "name" : "UPDATEBY"
  } ],
  "queryCode" : "SELECT\nt1.`BEGIN`,\n(case when t1.`begin` = '2030-01-01' then '待定' else t1.`begin` end) AS `BEGINSTR`,\nt1.`BRANCH`,\n((select count(t.id) FROM zt_bug t where  t.product = t1.product and  (t.plan = t1.id or (t.plan in (select t2.id from zt_productplan t2 where t2.parent = t1.id and t2.deleted = '0')) )  and t.deleted = '0')) AS `BUGCNT`,\nt1.`CREATEBY`,\ncase when t1.`end` is null or t1.`end` = '0000-00-00' or t1.`end` = '1970-01-01' then '' when t1.`status` in('wait','doing') and t1.`end` < DATE_FORMAT(NOW(),'%Y-%m-%d') then CONCAT('','延期',TO_DAYS(NOW()) - TO_DAYS(t1.`end`),'天') ELSE '' end AS `DELAY`,\nt1.`DELETED`,\nt1.`DEPT`,\nt1.`DEPTNAME`,\n(to_Days(t1.`END`) - to_Days(t1.`BEGIN`)) AS `DURATION`,\nt1.`END`,\n(case when t1.`end` = '2030-01-01' then '待定' else t1.`end` end) AS `ENDSTR`,\n(select sum(t.estimate) from zt_story t where  t.product = t1.product and  (t.plan = t1.id or (t.plan in (select t2.id from zt_productplan t2 where t2.parent = t1.id and t2.deleted = '0')) )  and t.deleted = '0' ) AS `ESTIMATECNT`,\n(case when t1.`begin` = '2030-01-01' or t1.`end` = '2030-01-01' then 'on' else '' end) AS `FUTURE`,\nt1.`ID`,\n(case when t1.`end` > now() then '0' else '1' end) AS `ISEXPIRED`,\nt1.`ORG`,\nt1.`ORGNAME`,\nt1.`PARENT`,\nt11.`TITLE` AS `PARENTNAME`,\nt1.`PRODUCT`,\nt1.`PRODUCTPLANSN`,\nt1.`STATUS`,\n(case when t1.parent = -1 then 'parent' when t1.parent > 0 then  'chlid' else 'normal' end) AS `STATUSS`,\n((select COUNT(t.id) from zt_story t where  t.product = t1.product and  (t.plan = t1.id or (t.plan in (select t2.id from zt_productplan t2 where t2.parent = t1.id and t2.deleted = '0')) )  and t.deleted = '0' )) AS `STORYCNT`,\nt1.`TITLE`,\nt1.`UPDATEBY`\nFROM `zt_productplan` t1 \nLEFT JOIN `zt_productplan` t11 ON t1.`PARENT` = t11.`ID` \n",
  "id" : "PSMODULES/zentao/PSDATAENTITIES/ProductPlan/PSDEDATAQUERIES/GetList/PSDEDQCODES/MYSQL5.json"
}