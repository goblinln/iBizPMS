{
  "dBType" : "MYSQL5",
  "name" : "MySQL5",
  "getPSDEDataQueryCodeConds" : [ {
    "condType" : "CUSTOM",
    "customCond" : "t1.DELETED = '0'",
    "name" : "查询条件"
  }, {
    "condType" : "CUSTOM",
    "customCond" : "t1.plan=#{srf.webcontext.plan}",
    "name" : "查询条件"
  } ],
  "queryCode" : "SELECT\nt1.id ,\nt1.`ASSIGNEDDATE`,\ncase when exists (select 1 from zt_team t where t.type = 'task' and t1.ID = t.root) then (select GROUP_CONCAT(t.account) from zt_team t where t.type = 'task' and t1.ID = t.root) else t1.assignedTo end as `ASSIGNEDTO`,\nt1.`CANCELEDBY`,\nt1.`CANCELEDDATE`,\nt1.`CLOSEDBY`,\nt1.`CLOSEDDATE`,\nt1.`CLOSEDREASON`,\nt1.`COLOR`,\nt1.`CONSUMED`,\nt1.`DEADLINE`,\nt1.`DELETED`,\n(To_Days(t1.`DEADLINE`)-To_Days(t1.`ESTSTARTED`)) AS `DURATION`,\nt1.`ESTIMATE`,\nt1.`ESTSTARTED`,\nt1.`FINISHEDBY`,\nt1.`FINISHEDDATE`,\nt1.`FROMBUG`,\nt1.`TASKSN`,\n(select (case when COUNT(t.IBZ_FAVORITESID) > 0 then 1 else 0 end ) as ISFAVORITES from T_IBZ_FAVORITES t where t.TYPE = 'task' and t.ACCOUNT = #{srf.sessioncontext.srfloginname} and t.OBJECTID = t1.ID ) AS `ISFAVORITES`,\n( CASE WHEN t1.parent > 0 THEN TRUE ELSE FALSE END ) AS `ISLEAF`,\nt1.`LASTEDITEDBY`,\nt1.`LASTEDITEDDATE`,\nt1.`LEFT`,\nt1.`MODULE`,\nt11.`NAME` AS `MODULENAME`,\n(SELECT case when tt.type = 'task' then GROUP_CONCAT( tt.NAME SEPARATOR '>' ) else CONCAT_WS('',t2.`name`,'>',GROUP_CONCAT( tt.NAME SEPARATOR '>' )) end as `name` FROM zt_module tt left join zt_product t2 on tt.root = t2.ID WHERE FIND_IN_SET( tt.id, t11.path )  and tt.deleted = '0'   GROUP BY tt.root limit 0,1) AS `MODULENAME1`,\n(case when t1.deadline is null or t1.deadline = '0000-00-00' or t1.deadline = '1970-01-01' then '' when t1.`status` in ('wait','doing') and t1.deadline <DATE_FORMAT(now(),'%y-%m-%d')  then CONCAT_WS('','延期',TIMESTAMPDIFF(DAY, t1.deadline, now()),'天') else '' end) AS `DELAY`,\n( SELECT case when count( t.`id` ) > 0 then 1 else 0 end FROM `zt_team` t WHERE t.`type` = 'task' AND t.`root` = t1.`ID` ) AS `MULTIPLE`,\nt1.`NAME`,\nt1.`OPENEDBY`,\nt1.`OPENEDDATE`,\nt1.`PARENT`,\nt51.`NAME` AS `PARENTNAME`,\nt11.`PATH`,\nt1.`PRI`,\nt21.`PRODUCT`,\nt41.`NAME` AS `PRODUCTNAME`,\nt1.`PROJECT`,\nt31.`NAME` AS `PROJECTNAME`,\nt1.`REALSTARTED`,\nt1.`STATUS`,\nt1.`STORY`,\nt21.`TITLE` AS `STORYNAME`,\nt1.`STORYVERSION`,\nt1.`SUBSTATUS`,\nt1.`TYPE`,\n\t( CASE WHEN ( SELECT CASE\t WHEN count( t.`id` ) > 0 THEN 1 ELSE 0  END  FROM `zt_team` t  WHERE t.`type` = 'task'  AND t.`root` = t1.`ID`  ) = 1 THEN '10'  WHEN t1.parent = - 1 THEN'20'   WHEN t1.parent = 0 THEN '30' ELSE '40' END) AS `TASKTYPE`,\nCONCAT_WS('',case when t1.consumed = 0 or t1.consumed is null then '0' when t1.`left` = 0 or t1.`left` is null then '100' else ROUND((ROUND(t1.`consumed`/(t1.`left` + t1.consumed),2)) * 100) end ,'%') as progressrate,\n(case when t1.storyVersion < t21.version and t21.`status` <> 'changed' then 'storychange'  else t1.`status` end ) as `STATUS1`,\n(case when t1.`status` = 'wait' then 10 when t1.`status` = 'doing' then 20 when t1.`status` = 'done' then 30 when t1.`status` = 'closed' then 40 when t1.`status` = 'cancel' then 50 else 60 end)\nas statusorder,\nt1.`PLAN`,\nt1.`TASKSPECIES`,\nt61.`TITLE` AS `PLANNAME`\nFROM `zt_task` t1 \nLEFT JOIN zt_module t11 ON t1.MODULE = t11.ID \nLEFT JOIN zt_story t21 ON t1.STORY = t21.ID \nLEFT JOIN zt_project t31 ON t1.PROJECT = t31.ID \nLEFT JOIN zt_product t41 ON t21.PRODUCT = t41.ID \nLEFT JOIN zt_task t51 ON t1.PARENT = t51.ID \nLEFT JOIN `zt_productplan` t61 ON t1.`PLAN` = t61.`ID`",
  "id" : "PSMODULES/zentao/PSDATAENTITIES/Task/PSDEDATAQUERIES/PlanTask/PSDEDQCODES/MYSQL5.json"
}