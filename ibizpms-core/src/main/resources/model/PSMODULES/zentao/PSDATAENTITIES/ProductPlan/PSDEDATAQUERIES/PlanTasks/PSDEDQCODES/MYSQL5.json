{
  "dBType" : "MYSQL5",
  "name" : "MySQL5",
  "getPSDEDataQueryCodeConds" : [ {
    "condType" : "CUSTOM",
    "customCond" : "t1.DELETED = '0'",
    "name" : "查询条件"
  }, {
    "condType" : "CUSTOM",
    "customCond" : "( ( t1.`PARENT` <= 0 ) )",
    "name" : "查询条件"
  } ],
  "queryCode" : "SELECT\ncase when t1.`end` is null or t1.`end` = '0000-00-00' or t1.`end` = '1970-01-01' then '' when t1.`status` in('wait','doing') and t1.`end` < DATE_FORMAT(NOW(),'%Y-%m-%d') then CONCAT('','延期',TO_DAYS(NOW()) - TO_DAYS(t1.`end`),'天') ELSE '' end as delay,\n\tt1.`BEGIN`,\n\t( CASE WHEN t1.`begin` = '2030-01-01' THEN '待定' ELSE t1.`begin` END ) AS `BEGINSTR`,\n\tt1.`BRANCH`,\n\t(\n\t(\nSELECT\n\tcount( t.id ) \nFROM\n\tzt_bug t \nWHERE t.product = t1.product and \n\t(\n\tt.plan = t1.id \n\tOR (\n\tt.plan IN ( SELECT t2.id FROM zt_productplan t2 WHERE t2.parent = t1.id AND t2.deleted = '0' ) \n\t) \n\t) \n\tAND t.deleted = '0' \n\t) \n\t) AS `BUGCNT`,\n\tt1.`DELETED`,\n\tt1.`END`,\n\t( CASE WHEN t1.`end` = '2030-01-01' THEN '待定' ELSE t1.`end` END ) AS `ENDSTR`,\n\t(\nSELECT\n\tsum( t.estimate ) \nFROM\n\tzt_story t \nWHERE t.product = t1.product and \n\t(\n\tt.plan = t1.id \n\tOR (\n\tt.plan IN ( SELECT t2.id FROM zt_productplan t2 WHERE t2.parent = t1.id AND t2.deleted = '0' ) \n\t) \n\t) \n\tAND t.deleted = '0' \n\t) AS `ESTIMATECNT`,\n\t( CASE WHEN t1.`begin` = '2030-01-01' OR t1.`end` = '2030-01-01' THEN 'on' ELSE '' END ) AS `FUTURE`,\n\tt1.`ID`,\n\t( CASE WHEN t1.`end` > now( ) THEN '0' ELSE '1' END ) AS `ISEXPIRED`,\n\tt1.`PARENT`,\n\tt11.`TITLE` AS `PARENTNAME`,\n\tt1.`PRODUCT`,\n\t( CASE WHEN t1.parent = - 1 THEN 'parent' WHEN t1.parent > 0 THEN 'chlid' ELSE 'normal' END ) AS `STATUSS`,\n\t(\n\t(\nSELECT\n\tCOUNT( t.id ) \nFROM\n\tzt_story t \nWHERE t.product = t1.product and \n\t(\n\tt.plan = t1.id \n\tOR (\n\tt.plan IN ( SELECT t2.id FROM zt_productplan t2 WHERE t2.parent = t1.id AND t2.deleted = '0' ) \n\t) \n\t) \n\tAND t.deleted = '0' \n\t) \n\t) AS `STORYCNT`,\n\t(\n\t(\nSELECT\n\tCOUNT( t.id ) \nFROM\n\tzt_task t \nWHERE  t.deleted = '0' and t.plan > 0 and \n\t(\n\tt.plan = t1.id \n\tOR (\n\tt.plan IN ( SELECT t2.id FROM zt_productplan t2 WHERE t2.parent = t1.id AND t2.deleted = '0' ) \n\t) \n\t) \n\t) \n\t) AS `TASKSCNT`,\n\t(\n\t(\nSELECT\n\tCOUNT( t.id ) \nFROM\n\tzt_task t \nWHERE  t.deleted = '0' and t.plan > 0 and \n\t(\n\tt.plan = t1.id \n\tOR (\n\tt.plan IN ( SELECT t2.id FROM zt_productplan t2 WHERE t2.parent = t1.id AND t2.deleted = '0' ) \n\t) \n\t) \n\tAND t.`status` = 'done' \n\t) \n\t) AS `FINISHEDTASKSCNT`,\n\t(\n\t(\nSELECT\n\tCOUNT( t.id ) \nFROM\n\tzt_task t \nWHERE  t.deleted = '0' and t.plan > 0 and \n\t(\n\tt.plan = t1.id \n\tOR (\n\tt.plan IN ( SELECT t2.id FROM zt_productplan t2 WHERE t2.parent = t1.id AND t2.deleted = '0' ) \n\t) \n\t) \n\tAND t.`status` IN ( 'doing', 'wait', 'pause' ) \n\t) \n\t) AS `UNFINISHEDTASKSCNT`,\n\t(\n\t(\nSELECT\n\tCOUNT( t.id ) \nFROM\n\tzt_task t \nWHERE  t.deleted = '0' and t.plan > 0 and \n\t(\n\tt.plan = t1.id \n\tOR (\n\tt.plan IN ( SELECT t2.id FROM zt_productplan t2 WHERE t2.parent = t1.id AND t2.deleted = '0' ) \n\t) \n\t) \n\tAND t.`status` IN ( 'wait', 'doing', 'pause' ) \n\tAND t.deadline != '0000-00-00' \n\tAND t.deadline != '1970-01-01' \n\tAND t.deadline < DATE_FORMAT( now( ), '%y-%m-%d' ) \n\t) \n\t) AS `DELAYTASKSCNT`,\n\tt1.`TITLE`,\n\tIFNULL(t2.LeftEstimate,0) as leftestimate,\n\tIFNULL(t2.ConsumedEstimate,0) as consumedestimate  ,\n        t1.`STATUS`\nFROM\n\t`zt_PRODUCTPLAN` t1\n\tLEFT JOIN `zt_PRODUCTPLAN` t11 ON t1.`PARENT` = t11.`ID`\n\tLEFT JOIN (\nSELECT\n\tSUM( t.LeftEstimate ) AS LeftEstimate,\n\tSUM( t.ConsumedEstimate ) AS ConsumedEstimate,\n\tt.plan \nFROM\n\t(\nSELECT\n\tt1.task,\n\tSUM( t1.LEFT ) AS LeftEstimate,\n\tSUM( t1.consumed ) AS ConsumedEstimate,\n\tt2.NAME,\n\tt2.plan \nFROM\n\tzt_taskestimate t1\n\tLEFT JOIN zt_task t2 ON t1.task = t2.id \n         where t2.deleted = '0' and t2.plan > 0 \nGROUP BY\n\tt1.task \n\t) t \nWHERE\n\tt.plan > 0 \nGROUP BY\n\tt.plan \n\t) t2 ON t1.id = t2.plan",
  "id" : "PSMODULES/zentao/PSDATAENTITIES/ProductPlan/PSDEDATAQUERIES/PlanTasks/PSDEDQCODES/MYSQL5.json"
}