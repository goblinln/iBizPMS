{
  "dBType" : "MYSQL5",
  "name" : "MySQL5",
  "queryCode" : "SELECT\n\tt1.* \nFROM\n\t(\nSELECT\n        t1.MDEPTID,\n        t1.orgid,\n\tt1.`ACL`,\n\t( SELECT COUNT( 1 ) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND `STATUS` = 'active' AND DELETED = '0' ) AS `ACTIVEBUGCNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND `STATUS` = 'active' AND DELETED = '0' ) AS `ACTIVESTORYCNT`,\n\t( SELECT count( 1 ) FROM zt_build t WHERE t.product = t1.id AND t.deleted = '0' ) AS `BUILDCNT`,\n\t( SELECT count( 1 ) FROM zt_case t WHERE t.product = t1.id AND t.deleted = '0' ) AS `CASECNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND `STATUS` = 'changed' AND DELETED = '0' ) AS `CHANGEDSTORYCNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND `STATUS` = 'closed' AND DELETED = '0' ) AS `CLOSEDSTORYCNT`,\n\tt1.`CODE`,\n\tt1.`CREATEDBY`,\n\tt1.`CREATEDDATE`,\n\tt1.`CREATEDVERSION`,\n\tt1.`DELETED`,\n\t( SELECT count( 1 ) FROM zt_doc t WHERE t.product = t1.id AND t.deleted = '0' ) AS `DOCCNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND `STATUS` = 'draft' AND DELETED = '0' ) AS `DRAFTSTORYCNT`,\n\tt1.`ID`,\n\tt1.`LINE`,\n\tt11.`NAME` AS `LINENAME`,\n\tt1.`NAME`,\n\t( SELECT COUNT( 1 ) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND `STATUS` <> 'closed' AND DELETED = '0' ) AS `NOTCLOSEDBUGCNT`,\n\tt1.`ORDER`,\n\t(CASE WHEN T2.OBJECTORDER IS NOT NULL THEN T2.OBJECTORDER ELSE  t1.`ORDER` END) as `ORDER1`,\n\t(CASE WHEN T2.OBJECTORDER IS NOT NULL THEN 1 ELSE 0 END) as `ISTOP`,\n\tt1.`PO`,\n\t( SELECT COUNT( 1 ) FROM ZT_PRODUCTPLAN WHERE PRODUCT = t1.`ID` AND DELETED = '0' ) AS `PRODUCTPLANCNT`,\n\tt1.`QD`,\n\tt1.`RD`,\n\t( SELECT COUNT( 1 ) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND DELETED = '0' ) AS `RELATEDBUGCNT`,\n\t(\nSELECT\n\tcount( 1 ) \nFROM\n\tzt_projectproduct t\n\tINNER JOIN zt_project t2 ON t2.id = t.project \nWHERE\n\tt.product = t1.id \n\tAND t2.deleted = '0' \n\t) AS `RELATEDPROJECTS`,\n\t( SELECT COUNT( 1 ) FROM ZT_RELEASE WHERE PRODUCT = t1.`ID` AND DELETED = '0' ) AS `RELEASECNT`,\n\tt1.`STATUS`,\n\tt1.`SUBSTATUS`,\n\tt1.`TYPE`,\n\t( SELECT COUNT( 1 ) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND `CONFIRMED` = 0 AND DELETED = '0' ) AS `UNCONFIRMBUGCNT`  ,\nt1.productsn\nFROM\n\t`zt_product` t1\n\tleft join t_ibz_top t2 on t1.id = t2.OBJECTID and t2.type = 'product' and t2.ACCOUNT = #{srf.sessioncontext.srfloginname}\n\tLEFT JOIN zt_module t11 ON t1.LINE = t11.ID\nWHERE\n\tt1.deleted = '0' \n\tAND (t1.acl = 'open' or  t1.CREATEDBY =  #{srf.sessioncontext.srfloginname} \n\tor t1.PO = #{srf.sessioncontext.srfloginname} \n\tor t1.RD = #{srf.sessioncontext.srfloginname} \n\tor t1.QD =  #{srf.sessioncontext.srfloginname} \n\t) \n\tUNION\nSELECT\n       t1.MDEPTID,\n        t1.orgid,\n\tt1.`ACL`,\n\t( SELECT COUNT( 1 ) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND `STATUS` = 'active' AND DELETED = '0' ) AS `ACTIVEBUGCNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND `STATUS` = 'active' AND DELETED = '0' ) AS `ACTIVESTORYCNT`,\n\t( SELECT count( 1 ) FROM zt_build t WHERE t.product = t1.id AND t.deleted = '0' ) AS `BUILDCNT`,\n\t( SELECT count( 1 ) FROM zt_case t WHERE t.product = t1.id AND t.deleted = '0' ) AS `CASECNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND `STATUS` = 'changed' AND DELETED = '0' ) AS `CHANGEDSTORYCNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND `STATUS` = 'closed' AND DELETED = '0' ) AS `CLOSEDSTORYCNT`,\n\tt1.`CODE`,\n\tt1.`CREATEDBY`,\n\tt1.`CREATEDDATE`,\n\tt1.`CREATEDVERSION`,\n\tt1.`DELETED`,\n\t( SELECT count( 1 ) FROM zt_doc t WHERE t.product = t1.id AND t.deleted = '0' ) AS `DOCCNT`,\n\t( SELECT COUNT( 1 ) FROM ZT_STORY WHERE PRODUCT = t1.`ID` AND `STATUS` = 'draft' AND DELETED = '0' ) AS `DRAFTSTORYCNT`,\n\tt1.`ID`,\n\tt1.`LINE`,\n\tt11.`NAME` AS `LINENAME`,\n\tt1.`NAME`,\n\t( SELECT COUNT( 1 ) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND `STATUS` <> 'closed' AND DELETED = '0' ) AS `NOTCLOSEDBUGCNT`,\n\tt1.`ORDER`,\n\t(CASE WHEN T2.OBJECTORDER IS NOT NULL THEN T2.OBJECTORDER ELSE  t1.`ORDER` END) as `ORDER1`,\n\t(CASE WHEN T2.OBJECTORDER IS NOT NULL THEN 1 ELSE 0 END) as `ISTOP`,\n\tt1.`PO`,\n\t( SELECT COUNT( 1 ) FROM ZT_PRODUCTPLAN WHERE PRODUCT = t1.`ID` AND DELETED = '0' ) AS `PRODUCTPLANCNT`,\n\tt1.`QD`,\n\tt1.`RD`,\n\t( SELECT COUNT( 1 ) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND DELETED = '0' ) AS `RELATEDBUGCNT`,\n\t(\nSELECT\n\tcount( 1 ) \nFROM\n\tzt_projectproduct t\n\tINNER JOIN zt_project t2 ON t2.id = t.project \nWHERE\n\tt.product = t1.id \n\tAND t2.deleted = '0' \n\t) AS `RELATEDPROJECTS`,\n\t( SELECT COUNT( 1 ) FROM ZT_RELEASE WHERE PRODUCT = t1.`ID` AND DELETED = '0' ) AS `RELEASECNT`,\n\tt1.`STATUS`,\n\tt1.`SUBSTATUS`,\n\tt1.`TYPE`,\n\t( SELECT COUNT( 1 ) FROM ZT_BUG WHERE PRODUCT = t1.`ID` AND `CONFIRMED` = 0 AND DELETED = '0' ) AS `UNCONFIRMBUGCNT` ,\nt1.productsn\nFROM\n\t`zt_product` t1\n\tleft join t_ibz_top t2 on t1.id = t2.OBJECTID and t2.type = 'product' and t2.ACCOUNT = #{srf.sessioncontext.srfloginname}\n\tLEFT JOIN zt_module t11 ON t1.LINE = t11.ID\nWHERE\n\tt1.deleted = '0' \n\tAND t1.ID IN (\nSELECT t.root from zt_team t\nWHERE\n\tt.account =  #{srf.sessioncontext.srfloginname} \n\tAND t.type = 'product' \n\t \n\t) \n\t) t1",
  "id" : "PSMODULES/zentao/PSDATAENTITIES/Product/PSDEDATAQUERIES/CurUer/PSDEDQCODES/MYSQL5.json"
}